-- Highlight Player Script with On/Off Toggle + Draggable GUI
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "HighlightGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 140, 0, 50)
Frame.Position = UDim2.new(0.1, 0, 0.1, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BorderSizePixel = 2
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0.5, 0)
Title.BackgroundTransparency = 1
Title.Text = "Highlight Players"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = Frame

local Toggle = Instance.new("TextButton")
Toggle.Size = UDim2.new(0.8, 0, 0.4, 0)
Toggle.Position = UDim2.new(0.1, 0, 0.55, 0)
Toggle.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
Toggle.Text = "ON"
Toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
Toggle.Font = Enum.Font.GothamBold
Toggle.TextSize = 14
Toggle.Parent = Frame

local Enabled = true
local Highlights = {}

-- Function to create highlight for a player
local function CreateHighlight(character)
	if not character or Highlights[character] then return end
	local highlight = Instance.new("Highlight")
	highlight.Adornee = character
	highlight.FillColor = Color3.fromRGB(255, 255, 0)
	highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
	highlight.FillTransparency = 0.3
	highlight.OutlineTransparency = 0
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop -- xuyên tường
	highlight.Parent = character
	Highlights[character] = highlight
end

-- Function to remove highlight
local function RemoveHighlight(character)
	if Highlights[character] then
		Highlights[character]:Destroy()
		Highlights[character] = nil
	end
end

-- Toggle button
Toggle.MouseButton1Click:Connect(function()
	Enabled = not Enabled
	Toggle.Text = Enabled and "ON" or "OFF"
	Toggle.BackgroundColor3 = Enabled and Color3.fromRGB(80, 150, 80) or Color3.fromRGB(150, 50, 50)

	if not Enabled then
		for _, h in pairs(Highlights) do
			h:Destroy()
		end
		Highlights = {}
	else
		for _, p in pairs(Players:GetPlayers()) do
			if p ~= LocalPlayer and p.Character then
				CreateHighlight(p.Character)
			end
		end
	end
end)

-- Auto update highlights
RunService.Heartbeat:Connect(function()
	if not Enabled then return end
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer then
			if player.Character and not Highlights[player.Character] then
				CreateHighlight(player.Character)
			end
		end
	end

	for char, h in pairs(Highlights) do
		if not char.Parent then
			RemoveHighlight(char)
		end
	end
end)

Players.PlayerRemoving:Connect(function(player)
	if player.Character then
		RemoveHighlight(player.Character)
	end
end)